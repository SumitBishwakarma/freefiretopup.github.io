<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Fee Tracker</title>
    <style>
        /* CSS Variables */
        :root {
            --text-on-dark-bg: #FFFFFF;
            --text-primary: #1A202C;
            --text-secondary: #4A5568;
            --header-content-color: #FFFFFF;
            --bg-body: #F7FAFC;
            --bg-header-initial: #2563EB;
            --bg-header-scrolled: #000000;
            --bg-card-modal: #FFFFFF;
            --accent-main: #2563EB;
            --accent-main-hover: #1D4ED8;
            --accent-danger: #DC2626;
            --accent-danger-hover: #B91C1C;
            --button-secondary-bg: #E2E8F0;
            --button-secondary-text: #2D3748;
            --button-secondary-hover: #CBD5E0;
            --border-color-soft: #E2E8F0;
            --input-bg: #FFFFFF;
            --input-focus-border: var(--accent-main);
            --input-focus-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
            --shadow-subtle: 0 1px 3px 0 rgba(0, 0, 0, 0.07), 0 1px 2px 0 rgba(0, 0, 0, 0.04);
            --shadow-standard: 0 4px 12px 0 rgba(0, 0, 0, 0.08);
            --shadow-strong: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.08);
            --border-radius-ui: 8px;
            --border-radius-button: 6px;
            --paid-month-bg: #D1FAE5;
            --paid-month-text: #065F46;
            --paid-month-border: #A7F3D0;
            --sidebar-bg: #FFFFFF;
            --sidebar-text-color: var(--text-primary);
            --sidebar-link-hover-bg: var(--button-secondary-bg);
            --sidebar-link-hover-text: var(--accent-main);
            --header-height: 70px;
        }

        /* Basic Reset and Body Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body); color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
            user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
            overflow: hidden;
        }
        .modal-content input[type="text"],
        .modal-content input[type="number"] {
            user-select: text; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text;
        }

        /* Splash Screen Styles */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-header-initial); /* This will be overridden by JS if admin settings exist */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.7s ease-in-out, visibility 0s 0.7s;
            /* For background image/video from admin panel */
            background-size: cover;
            background-position: center;
            overflow: hidden; /* Ensure video doesn't overflow */
        }
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .splash-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--header-content-color);
            /* Will be positioned on top of video by JS */
        }
        .splash-logo-title-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s cubic-bezier(0.25, 0.1, 0.25, 1), transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .splash-logo-title-wrapper.animate-in {
            opacity: 1;
            transform: translateY(0);
        }
        .splash-logo {
            width: 55px;
            height: 55px;
            fill: currentColor;
            margin-right: 15px;
        }
        .splash-title {
            font-size: 2.4em;
            font-weight: 600;
            line-height: 1.2;
            white-space: nowrap;
        }

        .loading-animation {
            margin-top: 40px;
            display: flex;
            justify-content: center;
        }
        .loading-dot {
            width: 12px;
            height: 12px;
            background-color: var(--header-content-color);
            border-radius: 50%;
            margin: 0 5px;
            animation: bounce-dot 1.4s infinite ease-in-out both;
        }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce-dot {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }


        .app-container {
            display: block;
            padding-top: var(--header-height);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in;
        }
        .app-container.visible {
            opacity: 1;
            visibility: visible;
        }

        /* Header Styles */
        .site-header {
            position: fixed; top: 0; left: 0; width: 100%; display: flex;
            justify-content: space-between; align-items: center; padding: 0 25px;
            background-color: var(--bg-header-initial); color: var(--header-content-color);
            z-index: 1000; transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            height: var(--header-height); box-shadow: var(--shadow-subtle);
        }
        .site-header.scrolled { background-color: var(--bg-header-scrolled); box-shadow: var(--shadow-standard); }
        .site-header .logo-title {
            display: flex;
            align-items: center;
            font-size: 1.5em;
            font-weight: 600;
        }
        .header-app-icon {
            width: 1.1em;
            height: 1.1em;
            fill: currentColor;
            margin-right: 0.4em;
            flex-shrink: 0;
        }
        .site-header .header-details-title {
            flex-grow: 1; text-align: center; font-size: 1.2em; font-weight: 600;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
            margin: 0 10px; color: var(--header-content-color);
        }
        .header-control-btn {
            background: transparent; border: none; color: var(--header-content-color);
            cursor: pointer; padding: 8px; border-radius: 50%;
            transition: background-color 0.2s ease; display: flex;
            align-items: center; justify-content: center;
            -webkit-tap-highlight-color: transparent; flex-shrink: 0;
        }
        .header-control-btn:hover, .header-control-btn:focus-visible { background-color: rgba(255,255,255,0.12); outline: none; }
        .header-control-btn svg { width: 26px; height: 26px; display: block; fill: currentColor; }
        .site-header .menu-icon .line {
            fill: none; stroke: var(--header-content-color); stroke-width: 2.5; stroke-linecap: round;
            transition: transform 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), opacity 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
            transform-origin: center;
        }
        .menu-icon.active .line1 { transform: translateY(6px) rotate(45deg); }
        .menu-icon.active .line2 { opacity: 0; }
        .menu-icon.active .line3 { transform: translateY(-6px) rotate(-45deg); }

        /* View Containers */
        .view-container { display: block; padding: 30px 25px; }
        .view-container.hidden { display: none; }
        #listViewContainer h2 { margin-bottom: 24px; font-size: 2em; color: var(--text-primary); font-weight: 700; }
        .item-list { list-style: none; padding: 0; }
        .item-list li {
            background-color: var(--bg-card-modal); padding: 18px 24px; margin-bottom: 16px;
            border-radius: var(--border-radius-ui); box-shadow: var(--shadow-standard);
            display: flex; justify-content: space-between; align-items: center;
            color: var(--text-primary); transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer; -webkit-tap-highlight-color: transparent;
        }
        .item-list li:hover { transform: translateY(-2px); box-shadow: var(--shadow-strong); }
        .item-list li .item-info { flex-grow: 1; margin-right: 16px; }
        .item-list li .remove-item {
            background: var(--accent-danger); color: var(--text-on-dark-bg); border: none;
            padding: 8px 14px; border-radius: var(--border-radius-button); cursor: pointer;
            font-size: 0.9em; font-weight: 500; transition: background-color 0.2s ease;
            flex-shrink: 0; -webkit-tap-highlight-color: transparent;
        }
        .item-list li .remove-item:hover { background: var(--accent-danger-hover); }
        .fab-add-button {
            position: fixed; bottom: 30px; right: 30px; background-color: var(--accent-main);
            color: var(--text-on-dark-bg); width: 60px; height: 60px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; box-shadow: var(--shadow-strong);
            cursor: pointer; transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.2s ease;
            z-index: 999; -webkit-tap-highlight-color: transparent;
        }
        .fab-add-button:hover { transform: scale(1.1); background-color: var(--accent-main-hover); }
        .fab-add-button:active { transform: scale(1.05); }
        .fab-add-button svg { width: 28px; height: 28px; fill: currentColor; }
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(30, 41, 59, 0.6); display: flex; justify-content: center;
            align-items: center; z-index: 1001; opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; transition: opacity 0.3s ease, visibility 0s 0s; }
        .modal-content {
            background-color: var(--bg-card-modal); padding: 32px; border-radius: var(--border-radius-ui);
            box-shadow: var(--shadow-strong); width: 90%; max-width: 480px;
            transform: translateY(15px) scale(0.98); opacity: 0;
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.3s ease;
        }
        .modal-overlay.active .modal-content { transform: translateY(0) scale(1); opacity: 1; }
        .modal-content h3 { margin-top: 0; margin-bottom: 28px; color: var(--text-primary); font-weight: 600; font-size: 1.5em; }
        .form-group { margin-bottom: 22px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); font-size: 0.9em; }
        .form-group input[type="text"], .form-group input[type="number"] {
            width: 100%; padding: 12px 16px; border: 1px solid var(--border-color-soft);
            border-radius: var(--border-radius-button); font-size: 1em; color: var(--text-primary);
            background-color: var(--input-bg); transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-group input[type="text"]:focus, .form-group input[type="number"]:focus { outline: none; border-color: var(--input-focus-border); box-shadow: var(--input-focus-shadow); }
        input.invalid { border-color: var(--accent-danger) !important; box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2) !important; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 32px; }
        .modal-button {
            padding: 10px 20px; border: none; border-radius: var(--border-radius-button); cursor: pointer;
            font-size: 0.95em; font-weight: 500; transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        .modal-button:active { transform: scale(0.98); }
        .modal-button:focus-visible { outline: 2px solid var(--accent-main); outline-offset: 2px; }
        .modal-button.primary { background-color: var(--accent-main); color: var(--text-on-dark-bg); box-shadow: var(--shadow-subtle); }
        .modal-button.primary:hover { background-color: var(--accent-main-hover); box-shadow: var(--shadow-standard); }
        .modal-button.secondary { background-color: var(--button-secondary-bg); color: var(--button-secondary-text); border: 1px solid var(--border-color-soft); }
        .modal-button.secondary:hover { background-color: var(--button-secondary-hover); }
        .details-item-summary {
            text-align: center; font-size: 1.2em; font-weight: 500; color: var(--text-primary);
            margin-bottom: 24px; padding: 10px; background-color: var(--bg-card-modal);
            border-radius: var(--border-radius-ui); box-shadow: var(--shadow-subtle);
        }
        .month-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 16px; }
        .month-item {
            background-color: var(--bg-card-modal); border: 1px solid var(--border-color-soft);
            padding: 20px 15px; text-align: center; border-radius: var(--border-radius-ui); cursor: pointer;
            transition: background-color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease;
            font-weight: 500; color: var(--text-secondary); box-shadow: var(--shadow-subtle);
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 90px;
            -webkit-tap-highlight-color: transparent;
        }
        .month-item:hover { transform: translateY(-2px); box-shadow: var(--shadow-standard); border-color: var(--accent-main); }
        .month-item.paid { background-color: var(--paid-month-bg); color: var(--paid-month-text); border-color: var(--paid-month-border); font-weight: 600; }
        .month-item.paid .tick-icon { display: inline-block; margin-top: 6px; }
        .tick-icon { display: none; width: 22px; height: 22px; fill: var(--paid-month-text); }

        .sidebar {
            position: fixed; top: 0; right: -280px; width: 280px; height: 100vh;
            background-color: var(--sidebar-bg); box-shadow: -3px 0 15px rgba(0,0,0,0.1);
            z-index: 1002; transition: transform 0.3s ease-in-out;
            color: var(--sidebar-text-color); padding-top: var(--header-height);
            overflow-y: auto; display: flex; flex-direction: column;
        }
        .sidebar.active { transform: translateX(-280px); }
        .sidebar-content { padding: 20px; flex-grow: 1; }
        .sidebar-content ul { list-style: none; padding: 0; margin: 0; }

        .sidebar-content ul li a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--sidebar-text-color);
            text-decoration: none;
            font-size: 1.05em;
            font-weight: 500;
            border-radius: var(--border-radius-button);
            transition: background-color 0.2s ease, color 0.2s ease;
            margin-bottom: 8px;
            -webkit-tap-highlight-color: transparent;
        }
        .sidebar-content ul li a:hover,
        .sidebar-content ul li a:focus-visible {
            background-color: var(--sidebar-link-hover-bg);
            color: var(--sidebar-link-hover-text);
            outline: none;
        }

        .sidebar-link-icon {
            width: 22px;
            height: 22px;
            fill: currentColor;
            margin-right: 12px;
            flex-shrink: 0;
            transition: fill 0.2s ease;
        }
        .sidebar-link-text {
            flex-grow: 1;
        }

        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.4); z-index: 1001;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }
        .sidebar-overlay.active { opacity: 1; visibility: visible; transition: opacity 0.3s ease, visibility 0s 0s; }
        .about-us-content { text-align: center; }
        .about-us-logo-placeholder {
            width: 150px; height: 150px; border-radius: 50%; /* object-fit will be handled by img inside */
            margin: 0 auto 20px auto; display: block;
            background-color: var(--border-color-soft); border: 3px solid var(--bg-card-modal);
            box-shadow: var(--shadow-standard);
            overflow: hidden; /* To ensure img corners are rounded if logo is not perfectly round */
        }
        .about-us-logo-placeholder img {
            width: 100%; height: 100%; border-radius: 50%; /* Make the image itself round */
            object-fit: cover;
        }
        .developer-info { font-size: 1.1em; font-weight: 600; color: var(--text-primary); margin: 20px auto 10px auto; }
        .about-us-title { font-size: 1.5em; color: var(--text-primary); margin-bottom: 10px; margin-top: 15px; }
        .about-us-description { font-size: 1em; color: var(--text-secondary); line-height: 1.7; max-width: 600px; margin: 0 auto 15px auto; }
        .app-version { font-size: 0.9em; color: var(--text-secondary); margin-top: 20px; }
        .social-icon-link {
            display: inline-block;
            margin-top: 15px;
            color: var(--text-primary);
            transition: color 0.2s ease, transform 0.2s ease;
            text-decoration: none;
             -webkit-tap-highlight-color: transparent;
        }
        .social-icon-link:hover, .social-icon-link:focus-visible {
            color: var(--accent-main);
            transform: scale(1.1);
            outline: none;
        }
        .social-icon-link svg {
            width: 32px;
            height: 32px;
            fill: currentColor;
            display: block;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .view-container { padding: 25px 20px; }
            .site-header .logo-title { font-size: 1.3em; }
            .site-header .header-details-title { font-size: 1.1em; margin: 0 5px; }
            .header-control-btn svg { width: 24px; height: 24px; }
            .fab-add-button { width: 56px; height: 56px; bottom: 20px; right: 20px; }
            .fab-add-button svg { width: 26px; height: 26px; }
            #listViewContainer h2 { font-size: 1.75em; }
            .details-item-summary { font-size: 1.1em; margin-bottom: 20px; }
            .modal-content { padding: 24px; max-width: calc(100% - 40px); }
            .item-list li { padding: 16px 20px; }
            .month-grid { grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 12px; }
            .month-item { padding: 15px 10px; min-height: 80px;}
            .sidebar { width: 250px; right: -250px; }
            .sidebar.active { transform: translateX(-250px); }
            .sidebar-link-icon { width: 20px; height: 20px; margin-right: 10px;}
            .about-us-logo-placeholder { width: 120px; height: 120px; }
            .about-us-title { font-size: 1.3em; }
            .developer-info { font-size: 1em; }
            .social-icon-link svg { width: 30px; height: 30px; }

            .splash-logo { width: 50px; height: 50px; margin-right: 12px; }
            .splash-title { font-size: 2.0em; }
            .loading-animation { margin-top: 30px; }
            .loading-dot { width: 10px; height: 10px; }
        }
        @media (max-width: 480px) {
            :root { --header-height: 60px; }
            .site-header { padding: 0 15px; }
            .site-header .logo-title { font-size: 1.2em; }
            .site-header .header-details-title { font-size: 1em; }
            #listViewContainer h2 { font-size: 1.5em; margin-bottom: 20px; }
            .details-item-summary { font-size: 1em; }
            .item-list li { padding: 14px 16px; margin-bottom: 12px; }
            .fab-add-button { width: 52px; height: 52px; }
            .fab-add-button svg { width: 24px; height: 24px; }
            .modal-button { padding: 10px 16px; font-size: 0.9em; }
            .month-grid { grid-template-columns: repeat(2, 1fr); }
            .sidebar { width: 220px; right: -220px; }
            .sidebar.active { transform: translateX(-220px); }
            .sidebar-link-icon { width: 18px; height: 18px; margin-right: 8px;}
            .about-us-logo-placeholder { width: 100px; height: 100px; }
            .about-us-title { font-size: 1.2em; }
            .developer-info { font-size: 0.95em; }
            .about-us-description { font-size: 0.9em; }
            .social-icon-link svg { width: 28px; height: 28px; }

            .splash-logo { width: 45px; height: 45px; margin-right: 10px; }
            .splash-title { font-size: 1.9em; }
            .loading-animation { margin-top: 25px; }
            .loading-dot { width: 8px; height: 8px; }
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo-title-wrapper" id="splashLogoTitleWrapper">
                <svg class="splash-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 0h24v24H0V0z" fill="none"/>
                    <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/>
                </svg>
                <span class="splash-title">𝕸𝖔𝖓𝖙𝖍𝖑𝖞 𝕱𝖊𝖊</span>
            </div>
            <div class="loading-animation">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="appContainer" class="app-container">
        <header class="site-header">
            <button id="headerBackBtn" class="header-control-btn" style="display: none;" aria-label="Back to List">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>

            <div class="logo-title" id="headerSiteTitle">
                <svg class="header-app-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                    <path d="M0 0h24v24H0V0z" fill="none"/>
                    <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/>
                </svg>
                <span id="headerSiteTitleTextSpan">𝕸𝖔𝖓𝖙𝖍𝖑𝖞 𝕱𝖊𝖊</span>
            </div>

            <div id="headerDetailsTitle" class="header-details-title" style="display: none;"></div>
            <div class="menu-icon header-control-btn" id="menuIcon" aria-label="Toggle menu" role="button" tabindex="0" aria-expanded="false">
                <svg viewBox="0 0 24 24"><line class="line line1" x1="3" y1="6" x2="21" y2="6"/><line class="line line2" x1="3" y1="12" x2="21" y2="12"/><line class="line line3" x1="3" y1="18" x2="21" y2="18"/></svg>
            </div>
        </header>

        <div id="listViewContainer" class="view-container">
            <h2>Fee Records</h2>
            <ul id="itemList" class="item-list"></ul>
        </div>

        <div id="detailsViewContainer" class="view-container hidden">
            <div id="detailsItemSummary" class="details-item-summary">Total Paid: 0.00</div>
            <div class="month-grid" id="monthGrid"></div>
        </div>

        <div id="aboutUsViewContainer" class="view-container hidden">
            <div class="about-us-content">
                <div id="aboutUsLogoContainer" class="about-us-logo-placeholder">
                    <!-- Logo will be inserted here by JavaScript -->
                </div>
                <p class="developer-info">Developed by: Sumit Bishwakarma</p>
                <h3 class="about-us-title">About This Application</h3>
                <p class="about-us-description">This application helps you track your monthly fee records efficiently. Manage your payments and stay organized with ease.</p>
                <p class="app-version">Version: 1.0.0</p>
                <!-- Instagram link with id="instagramLink" -->
                <a href="https://www.instagram.com/death_force_2006?igsh=MXMzejhyYzJjbjFhdw=="
                   id="instagramLink"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="social-icon-link"
                   aria-label="Sumit Bishwakarma on Instagram">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919C5.856 2.235 6.235 2.223 8.887 2.163H12zm0-2.163C8.741 0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4c2.21 0 4 1.791 4 4s-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>
                </a>
            </div>
        </div>

        <button class="fab-add-button" id="fabAddButton" aria-label="Add new fee record">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/><path d="M0 0h24v24H0z" fill="none"/></svg>
        </button>

        <div class="modal-overlay" id="addItemModal">
            <div class="modal-content" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
                <h3 id="modalTitle">Add New Fee Record</h3>
                <form id="addItemForm" novalidate>
                    <div class="form-group"><label for="itemName">Name / Description</label><input type="text" id="itemName" name="itemName" required placeholder="Monthly record"></div>
                    <div class="form-group"><label for="itemAmount">Amount</label><input type="number" id="itemAmount" name="itemAmount" required placeholder="Monthly fee" min="0" step="0.01"></div>
                    <div class="modal-actions"><button type="button" class="modal-button secondary" id="cancelModalButton">Cancel</button><button type="submit" class="modal-button primary">Add Record</button></div>
                </form>
            </div>
        </div>

        <div id="sidebar" class="sidebar">
            <div class="sidebar-content">
                <ul>
                    <li>
                        <a href="#" id="homeLink">
                            <svg class="sidebar-link-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z"/></svg>
                            <span class="sidebar-link-text">Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="aboutUsLink">
                            <svg class="sidebar-link-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 7h2v2h-2V7zm0 4h2v6h-2v-6zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                            <span class="sidebar-link-text">About Us</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="adRemovePlanLink">
                            <svg class="sidebar-link-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M9.68 13.69L12 11.93l2.32 1.76-.88-2.78L15.5 9.21l-2.84-.25L12 6.5l-.66 2.46-2.84.25 2.06 1.7L9.68 13.69zm2.32 7.81L3 16.25V9l9 4.75L21 9v7.25L12 21.5zM12 2L1 7.58v8.76L12 22l11-5.66V7.58L12 2z"/></svg>
                            <span class="sidebar-link-text">Ad Remove Plan</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="sidebarOverlay" class="sidebar-overlay"></div>

    </div> <!-- End of App Container -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- HTML এলিমেন্টগুলোর নির্বাচক (Selectors for HTML Elements) ---
            const splashScreen = document.getElementById('splashScreen');
            const appContainer = document.getElementById('appContainer');
            const splashLogoTitleWrapper = document.getElementById('splashLogoTitleWrapper');

            const siteHeader = document.querySelector('.site-header');
            const menuIcon = document.getElementById('menuIcon');
            const fabAddButton = document.getElementById('fabAddButton');
            const addItemModal = document.getElementById('addItemModal');

            const headerSiteTitle = document.getElementById('headerSiteTitle');
            const headerSiteTitleTextSpan = document.getElementById('headerSiteTitleTextSpan');
            const headerBackBtn = document.getElementById('headerBackBtn');
            const headerDetailsTitleEl = document.getElementById('headerDetailsTitle');

            const listViewContainer = document.getElementById('listViewContainer');
            const detailsViewContainer = document.getElementById('detailsViewContainer');
            const aboutUsViewContainer = document.getElementById('aboutUsViewContainer');
            const aboutUsLogoContainer = document.getElementById('aboutUsLogoContainer');
            const instagramLinkElement = document.getElementById('instagramLink');

            const detailsItemSummaryEl = document.getElementById('detailsItemSummary');
            const monthGridEl = document.getElementById('monthGrid');

            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const sidebarLinks = sidebar.querySelectorAll('.sidebar-content ul li a');

            const itemNameInput = document.getElementById('itemName');
            const itemAmountInput = document.getElementById('itemAmount');
            const addItemForm = document.getElementById('addItemForm');
            const cancelModalButton = document.getElementById('cancelModalButton');
            const itemListEl = document.getElementById('itemList');
            let firstFocusableElementModal, lastFocusableElementModal;

            let feeRecords = [];
            let currentItemViewingId = null;
            const MONTH_NAMES = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const DEFAULT_INSTAGRAM_URL = "https://www.instagram.com/death_force_2006?igsh=MXMzejhyYzJjbjFhdw==";


            // --- Functions to Apply Admin Settings ---

            // MODIFIED/IMPROVED applySplashScreenSettings function
            function applySplashScreenSettings() {
                if (!splashScreen) {
                    console.error("Splash screen element (splashScreen) not found in HTML!");
                    return;
                }

                const adminSplashBgType = localStorage.getItem('admin_splash_background_type');
                const adminSplashBgValue = localStorage.getItem('admin_splash_background_value');
                const splashContentDiv = splashScreen.querySelector('.splash-content');

                // Cleanup: Remove any existing video element from previous runs
                const existingVideo = splashScreen.querySelector('video.splash-video-background');
                if (existingVideo) {
                    existingVideo.remove();
                }
                // Reset splashContent z-index styling
                if (splashContentDiv) {
                    splashContentDiv.style.position = ''; // Reset to default (static)
                    splashContentDiv.style.zIndex = '';   // Reset z-index
                }

                // Set default styles first
                splashScreen.style.backgroundImage = 'none'; // Clear image by default
                splashScreen.style.backgroundColor = 'var(--bg-header-initial)'; // Apply default/fallback color

                if (adminSplashBgType && adminSplashBgValue) {
                    console.log("Splash Settings Found: Type -", adminSplashBgType, ", Value (start) -", adminSplashBgValue.substring(0, 60) + "...");
                    if (adminSplashBgType === 'color') {
                        splashScreen.style.backgroundColor = adminSplashBgValue;
                        // Ensure no BG image is visible if color is set
                        splashScreen.style.backgroundImage = 'none';
                    } else if (adminSplashBgType === 'image_url' || adminSplashBgType === 'image_file') {
                        splashScreen.style.backgroundImage = `url('${adminSplashBgValue}')`;
                        // Background color might be transparent or a specific color if the image has transparency
                        // For simplicity, let's ensure it's not showing the default blue if an image is there
                        // splashScreen.style.backgroundColor = 'transparent'; // Optional: or let CSS variable decide
                    } else if (adminSplashBgType === 'video_file') {
                        // For video, make background transparent and remove image
                        splashScreen.style.backgroundColor = 'transparent';
                        splashScreen.style.backgroundImage = 'none';

                        const videoElement = document.createElement('video');
                        videoElement.classList.add('splash-video-background'); // For easy selection if needed later
                        videoElement.src = adminSplashBgValue;
                        videoElement.autoplay = true;
                        videoElement.loop = true;
                        videoElement.muted = true; // Essential for autoplay in most browsers
                        videoElement.playsInline = true; // Good practice for mobile (iOS)

                        // Style the video to cover the entire splash screen
                        videoElement.style.position = 'absolute';
                        videoElement.style.top = '0';
                        videoElement.style.left = '0';
                        videoElement.style.width = '100%';
                        videoElement.style.height = '100%';
                        videoElement.style.objectFit = 'cover';
                        videoElement.style.zIndex = '0'; // Video at the base layer within splashScreen

                        // Prepend video so it's behind other content by DOM order initially
                        splashScreen.insertBefore(videoElement, splashScreen.firstChild);

                        // Ensure splash-content (logo, title, loading) is on top of the video
                        if (splashContentDiv) {
                            splashContentDiv.style.position = 'relative'; // Needed for z-index to work reliably
                            splashContentDiv.style.zIndex = '1';          // Place above the video (z-index: 0)
                        }
                        
                        videoElement.play().catch(error => {
                             console.warn("Splash video autoplay was prevented or failed:", error);
                             // You could implement a fallback here if video fails to play
                        });

                    }
                } else {
                    console.log("No admin splash settings found or value is empty. Using default styles from CSS (color and no image/video).");
                    // Default background color `var(--bg-header-initial)` is already set.
                    // Ensure no background image if only default color is intended
                    splashScreen.style.backgroundImage = 'none';
                }
            }


            function loadAboutUsLogoFromAdminSettings() {
                if (!aboutUsLogoContainer) {
                    console.warn("About Us logo container (aboutUsLogoContainer) not found in HTML.");
                    return;
                }
                const logoData = localStorage.getItem('aboutUsAppLogo');
                aboutUsLogoContainer.innerHTML = '';

                if (logoData) {
                    console.log("About Us Logo found in localStorage. Applying it.");
                    const logoImg = document.createElement('img');
                    logoImg.src = logoData;
                    logoImg.alt = "Application Logo";
                    aboutUsLogoContainer.appendChild(logoImg);
                    aboutUsLogoContainer.style.backgroundColor = 'transparent';
                } else {
                    console.log("No About Us logo found in localStorage. Default placeholder style will be used.");
                    aboutUsLogoContainer.style.backgroundColor = 'var(--border-color-soft)';
                }
            }

            function applyInstagramLinkFromAdminSettings() {
                if (!instagramLinkElement) {
                    console.warn("Instagram link element (id='instagramLink') not found in HTML.");
                    return;
                }
                const adminInstagramUrl = localStorage.getItem('admin_instagram_url');
                if (adminInstagramUrl && adminInstagramUrl.trim() !== "") {
                    console.log("Instagram URL found in localStorage. Applying:", adminInstagramUrl);
                    instagramLinkElement.href = adminInstagramUrl;
                } else {
                    console.log("No Instagram URL found in localStorage or it is empty. Using default:", DEFAULT_INSTAGRAM_URL);
                    instagramLinkElement.href = DEFAULT_INSTAGRAM_URL;
                }
            }

            applySplashScreenSettings();


            if (splashScreen && appContainer && splashLogoTitleWrapper) {
                setTimeout(() => {
                    splashLogoTitleWrapper.classList.add('animate-in');
                }, 200);

                const splashTotalDuration = 3000;

                setTimeout(() => {
                    splashScreen.classList.add('hidden');
                    if(document.body) document.body.style.overflow = '';
                    if(appContainer) appContainer.classList.add('visible');
                    loadRecordsFromLocalStorage();
                    showListView();
                }, splashTotalDuration);
            } else {
                console.warn("Essential splash screen or app container elements are missing. App might not load correctly.");
                if (appContainer) appContainer.classList.add('visible');
                if(document.body) document.body.style.overflow = '';
                loadRecordsFromLocalStorage();
                showListView();
            }


            function hideAllViews() {
                if(listViewContainer) listViewContainer.classList.add('hidden');
                if(detailsViewContainer) detailsViewContainer.classList.add('hidden');
                if(aboutUsViewContainer) aboutUsViewContainer.classList.add('hidden');
            }

            function configureHeader(mode, title = "") {
                if (menuIcon) {
                    menuIcon.style.display = 'flex';
                    menuIcon.style.visibility = 'visible';
                    menuIcon.style.pointerEvents = 'auto';
                }

                switch(mode) {
                    case "list":
                        if(headerSiteTitle) headerSiteTitle.style.display = 'flex';
                        if(headerSiteTitleTextSpan) headerSiteTitleTextSpan.textContent = "𝕸𝖔𝖓𝖙𝖍𝖑𝖞 𝕱𝖊𝖊";
                        if(headerDetailsTitleEl) headerDetailsTitleEl.style.display = 'none';
                        if(headerBackBtn) headerBackBtn.style.display = 'none';
                        if(fabAddButton) fabAddButton.style.display = 'flex';
                        break;
                    case "details":
                        if(headerSiteTitle) headerSiteTitle.style.display = 'none';
                        if(headerDetailsTitleEl) {
                            headerDetailsTitleEl.textContent = title;
                            headerDetailsTitleEl.style.display = 'block';
                        }
                        if(headerBackBtn) headerBackBtn.style.display = 'flex';
                        if(fabAddButton) fabAddButton.style.display = 'none';
                        break;
                    case "about":
                        if(headerSiteTitle) headerSiteTitle.style.display = 'none';
                        if(headerDetailsTitleEl) {
                            headerDetailsTitleEl.textContent = "About Us";
                            headerDetailsTitleEl.style.display = 'block';
                        }
                        if(headerBackBtn) headerBackBtn.style.display = 'flex';
                        if(menuIcon) {
                            menuIcon.style.visibility = 'hidden';
                            menuIcon.style.pointerEvents = 'none';
                        }
                        if(fabAddButton) fabAddButton.style.display = 'none';
                        break;
                }
            }

            function showListView() {
                hideAllViews();
                if(listViewContainer) listViewContainer.classList.remove('hidden');
                configureHeader("list");
                currentItemViewingId = null;
                renderItemList();
                window.scrollTo(0,0);
                if (sidebar && sidebar.classList.contains('active')) {
                    closeSidebar();
                }
            }

            function showDetailsView(itemId) {
                currentItemViewingId = itemId;
                const item = feeRecords.find(record => record.id === itemId);
                if (!item) {
                    showListView();
                    return;
                }
                hideAllViews();
                if(detailsViewContainer) detailsViewContainer.classList.remove('hidden');
                configureHeader("details", `${item.name} - ${parseFloat(item.amount).toFixed(2)}`);
                renderMonthGrid(item);
                updateItemTotalPaidDisplay(item);
                window.scrollTo(0,0);
            }

            function showAboutUsView() {
                hideAllViews();
                if(aboutUsViewContainer) aboutUsViewContainer.classList.remove('hidden');
                configureHeader("about");
                loadAboutUsLogoFromAdminSettings();
                applyInstagramLinkFromAdminSettings();
                window.scrollTo(0,0);
                if (sidebar && sidebar.classList.contains('active')) {
                    closeSidebar();
                }
            }

            function saveRecordsToLocalStorage() {
                try {
                    localStorage.setItem('feeRecords', JSON.stringify(feeRecords));
                } catch (e) {
                    console.error("Error saving fee records to localStorage:", e);
                }
            }
            function loadRecordsFromLocalStorage() {
                try {
                    const storedRecords = localStorage.getItem('feeRecords');
                    if (storedRecords) {
                        feeRecords = JSON.parse(storedRecords);
                    }
                } catch (e) {
                    console.error("Error loading fee records from localStorage:", e);
                    feeRecords = [];
                }
            }

            function renderItemList() {
                if (!itemListEl) {
                    console.error("Item list element (itemList) not found.");
                    return;
                }
                itemListEl.innerHTML = '';
                if (feeRecords.length === 0) {
                    const p = document.createElement('p');
                    p.textContent = 'No fee records yet. Add one using the "+" button.';
                    p.style.textAlign = 'center';
                    p.style.color = 'var(--text-secondary)';
                    p.style.padding = '20px 0';
                    itemListEl.appendChild(p);
                    return;
                }
                const fragment = document.createDocumentFragment();
                feeRecords.slice().reverse().forEach(item => {
                    const li = document.createElement('li');
                    li.setAttribute('data-id', item.id);
                    li.setAttribute('role', 'button');
                    li.tabIndex = 0;
                    li.setAttribute('aria-label', `View details for ${item.name}`);

                    const infoDiv = document.createElement('div');
                    infoDiv.classList.add('item-info');
                    infoDiv.textContent = `${item.name} - ${parseFloat(item.amount).toFixed(2)}`;

                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Remove';
                    removeBtn.classList.add('remove-item');
                    removeBtn.setAttribute('aria-label', `Remove record: ${item.name}`);
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (confirm(`Are you sure you want to remove "${item.name}"?`)) {
                            removeFeeRecord(item.id);
                        }
                    });

                    li.appendChild(infoDiv);
                    li.appendChild(removeBtn);
                    li.addEventListener('click', () => showDetailsView(item.id));
                    li.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            showDetailsView(item.id);
                        }
                    });
                    fragment.appendChild(li);
                });
                itemListEl.appendChild(fragment);
            }

            function renderMonthGrid(item) {
                if (!monthGridEl) {
                     console.error("Month grid element (monthGrid) not found.");
                     return;
                }
                monthGridEl.innerHTML = '';
                MONTH_NAMES.forEach((monthName, index) => {
                    const monthDiv = document.createElement('div');
                    monthDiv.classList.add('month-item');
                    monthDiv.setAttribute('data-month-index', index);
                    monthDiv.setAttribute('role', 'button');
                    monthDiv.tabIndex = 0;

                    const monthText = document.createElement('span');
                    monthText.textContent = monthName;
                    monthDiv.appendChild(monthText);

                    const tickSVG = `<svg class="tick-icon" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>`;
                    if (item.paidMonths && item.paidMonths[index]) {
                        monthDiv.classList.add('paid');
                        monthText.insertAdjacentHTML('afterend', tickSVG);
                        monthDiv.setAttribute('aria-pressed', 'true');
                        monthDiv.setAttribute('aria-label', `${monthName} - Marked as Paid. Click to mark as unpaid.`);
                    } else {
                        monthDiv.setAttribute('aria-pressed', 'false');
                        monthDiv.setAttribute('aria-label', `${monthName} - Marked as Unpaid. Click to mark as paid.`);
                    }

                    monthDiv.addEventListener('click', () => toggleMonthPayment(item.id, index));
                    monthDiv.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            toggleMonthPayment(item.id, index);
                        }
                    });
                    monthGridEl.appendChild(monthDiv);
                });
            }

            function addNewFeeRecord(name, amount) {
                if (!name.trim() || isNaN(parseFloat(amount)) || parseFloat(amount) < 0) {
                    alert("Please provide a valid name and a non-negative amount.");
                    return;
                }
                const newRecord = {
                    id: Date.now().toString(),
                    name: name.trim(),
                    amount: parseFloat(amount),
                    paidMonths: Array(12).fill(false)
                };
                feeRecords.push(newRecord);
                saveRecordsToLocalStorage();
                renderItemList();
            }

            function removeFeeRecord(itemId) {
                feeRecords = feeRecords.filter(item => item.id !== itemId);
                saveRecordsToLocalStorage();
                renderItemList();
                if (currentItemViewingId === itemId) {
                    showListView();
                }
            }

            function calculateTotalPaidForItem(item) {
                if (!item || !item.paidMonths) return 0;
                return item.paidMonths.reduce((total, isPaid) => {
                    return isPaid ? total + parseFloat(item.amount) : total;
                }, 0);
            }

            function updateItemTotalPaidDisplay(item) {
                if (!detailsItemSummaryEl) {
                    console.warn("Details item summary element (detailsItemSummary) not found.");
                    return;
                }
                const totalPaid = item ? calculateTotalPaidForItem(item) : 0;
                detailsItemSummaryEl.textContent = `Total Paid: ${totalPaid.toFixed(2)}`;
            }

            function toggleMonthPayment(itemId, monthIndex) {
                const itemIndex = feeRecords.findIndex(record => record.id === itemId);
                if (itemIndex > -1) {
                    feeRecords[itemIndex].paidMonths[monthIndex] = !feeRecords[itemIndex].paidMonths[monthIndex];
                    saveRecordsToLocalStorage();
                    renderMonthGrid(feeRecords[itemIndex]);
                    updateItemTotalPaidDisplay(feeRecords[itemIndex]);
                }
            }

            function setupModalFocusTrap() {
                if (!addItemModal) return;
                const modalContent = addItemModal.querySelector('.modal-content');
                if (!modalContent) return;
                const focusableElementsString = 'button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])';
                const focusableModalElements = modalContent.querySelectorAll(focusableElementsString);
                if (focusableModalElements.length > 0) {
                    firstFocusableElementModal = focusableModalElements[0];
                    lastFocusableElementModal = focusableModalElements[focusableModalElements.length - 1];
                } else {
                    firstFocusableElementModal = modalContent;
                    lastFocusableElementModal = modalContent;
                }
            }

            function openModal() {
                if (!addItemModal) return;
                addItemModal.classList.add('active');
                setupModalFocusTrap();
                if(itemNameInput) itemNameInput.focus();
                if(document.body) document.body.style.overflow = 'hidden';
            }

            function closeModal() {
                if (!addItemModal) return;
                addItemModal.classList.remove('active');
                if(addItemForm) addItemForm.reset();
                if(itemNameInput) itemNameInput.classList.remove('invalid');
                if(itemAmountInput) itemAmountInput.classList.remove('invalid');
                if (fabAddButton) fabAddButton.focus();
                const isSplashHidden = splashScreen ? splashScreen.classList.contains('hidden') : true;
                const isSidebarClosed = sidebar ? !sidebar.classList.contains('active') : true;
                if (isSplashHidden && isSidebarClosed && document.body) {
                    document.body.style.overflow = '';
                }
            }

            function openSidebar() {
                if(!sidebar || !sidebarOverlay || !menuIcon) return;
                sidebar.classList.add('active');
                sidebarOverlay.classList.add('active');
                menuIcon.classList.add('active');
                menuIcon.setAttribute('aria-expanded', 'true');
                if(document.body) document.body.style.overflow = 'hidden';
            }
            function closeSidebar() {
                if(!sidebar || !sidebarOverlay || !menuIcon) return;
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                menuIcon.classList.remove('active');
                menuIcon.setAttribute('aria-expanded', 'false');
                const isSplashHidden = splashScreen ? splashScreen.classList.contains('hidden') : true;
                const isModalClosed = addItemModal ? !addItemModal.classList.contains('active') : true;
                if (isSplashHidden && isModalClosed && document.body) {
                    document.body.style.overflow = '';
                }
            }

            if(siteHeader) {
                window.addEventListener('scroll', () => {
                    siteHeader.classList.toggle('scrolled', window.scrollY > 20);
                });
            }

            if(menuIcon) {
                menuIcon.addEventListener('click', () => {
                    if (sidebar && sidebar.classList.contains('active')) {
                        closeSidebar();
                    } else {
                        openSidebar();
                    }
                });
                menuIcon.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        menuIcon.click();
                    }
                });
            }

            if(sidebarOverlay) {
                sidebarOverlay.addEventListener('click', closeSidebar);
            }

            if(sidebarLinks && sidebarLinks.length > 0) {
                sidebarLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const linkId = e.currentTarget.id;
                        if (linkId === 'homeLink') {
                            showListView();
                        } else if (linkId === 'aboutUsLink') {
                            showAboutUsView();
                        } else if (linkId === 'adRemovePlanLink') {
                            alert('Ad Remove Plan feature is not yet implemented.');
                            closeSidebar();
                        }
                    });
                });
            }

            if(fabAddButton) {
                fabAddButton.addEventListener('click', openModal);
            }

            if(cancelModalButton) {
                cancelModalButton.addEventListener('click', closeModal);
            }

            if(addItemModal) {
                addItemModal.addEventListener('click', (e) => {
                    if (e.target === addItemModal) {
                        closeModal();
                    }
                });
            }

            if(addItemForm) {
                addItemForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const name = itemNameInput.value.trim();
                    const amountStr = itemAmountInput.value.trim();
                    let valid = true;
                    itemNameInput.classList.remove('invalid');
                    itemAmountInput.classList.remove('invalid');
                    if (!name) {
                        itemNameInput.classList.add('invalid');
                        valid = false;
                    }
                    if (!amountStr || isNaN(parseFloat(amountStr)) || parseFloat(amountStr) < 0) {
                        itemAmountInput.classList.add('invalid');
                        valid = false;
                    }
                    if (valid) {
                        addNewFeeRecord(name, parseFloat(amountStr));
                        closeModal();
                    } else {
                        if (itemNameInput.classList.contains('invalid')) {
                            itemNameInput.focus();
                        } else if (itemAmountInput.classList.contains('invalid')) {
                            itemAmountInput.focus();
                        }
                    }
                });
            }

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (sidebar && sidebar.classList.contains('active')) {
                        closeSidebar();
                    } else if (addItemModal && addItemModal.classList.contains('active')) {
                        closeModal();
                    } else if ( (detailsViewContainer && !detailsViewContainer.classList.contains('hidden')) ||
                               (aboutUsViewContainer && !aboutUsViewContainer.classList.contains('hidden')) ) {
                        showListView();
                    }
                }
                if (addItemModal && addItemModal.classList.contains('active') && e.key === 'Tab') {
                    if (!firstFocusableElementModal || !lastFocusableElementModal) {
                        setupModalFocusTrap();
                    }
                    if (!firstFocusableElementModal) return;
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusableElementModal) {
                            lastFocusableElementModal.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastFocusableElementModal) {
                            firstFocusableElementModal.focus();
                            e.preventDefault();
                        }
                    }
                }
            });

            if(headerBackBtn) {
                headerBackBtn.addEventListener('click', showListView);
            }
        });
    </script>
</body>
</html>
