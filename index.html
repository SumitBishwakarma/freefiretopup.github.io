<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TubeSaver - YouTube Video & Music Downloader</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Base Styles & Variables */
        :root {
            --primary-color-val: 77, 106, 255; /* For rgba() */
            --primary-color: rgb(var(--primary-color-val)); /* #4d6aff */
            --primary-light: #56aeff;
            --primary-dark: #3a0ca3;
            --secondary-color: #ff408c;
            --secondary-light: #ff6b95;
            --accent-color: #7209b7;
            --light-color: #ffffff;
            --dark-color: #0c0f25;    /* Main background */
            --dark-medium: #161b33; /* Secondary background / cards */
            --dark-deep: #1a1f36;   /* Slightly deeper dark for elements like preview box */
            --gray-color: #1b1f3b;   /* Lighter background elements */
            --gray-medium: #2d325a; /* Borders / Dividers */
            --text-color: #ffffff;   /* Main text color on dark background */
            --text-light: #b8c1ec; /* Secondary text color */
            --border-radius-sm: 6px;
            --border-radius: 12px;
            --border-radius-lg: 20px;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
            --font-primary: 'Poppins', sans-serif;
            --font-heading: 'Montserrat', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            color: var(--text-color);
            background-color: var(--dark-color);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 20px;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
            transition: var(--transition);
        }

        ul {
            list-style: none;
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius-sm); /* Smaller radius for general images */
        }

        .section-title {
            font-family: var(--font-heading);
            font-size: 2.75rem;
            text-align: center;
            margin-bottom: 3.5rem;
            color: var(--light-color);
            position: relative;
            font-weight: 800;
        }

        .section-title span {
            background-image: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .section-title::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -15px;
            transform: translateX(-50%);
            width: 80px;
            height: 5px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 5px;
        }

        .btn {
            display: inline-block;
            padding: 0.8rem 1.6rem;
            background: linear-gradient(to right, var(--primary-color), var(--primary-light));
            color: var(--light-color);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
            z-index: 1;
            box-shadow: 0 4px 15px rgba(var(--primary-color-val), 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, var(--primary-light), var(--secondary-color));
            transition: var(--transition);
            z-index: -1;
        }

        .btn:hover::before {
            left: 0;
        }

        .btn:hover {
            box-shadow: 0 6px 20px rgba(var(--primary-color-val), 0.4);
            transform: translateY(-2px);
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }
        
        /* Navigation Bar */
        .navbar {
            background-color: var(--dark-medium);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }
        .logo a {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            font-weight: 800;
            background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
        }
        .logo i {
            color: var(--primary-color); /* Fallback, gradient on text a */
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }
        .nav-menu { display: flex; align-items: center; }
        .nav-menu li { margin-left: 2rem; }
        .nav-menu a { color: var(--light-color); font-weight: 500; padding: 0.5rem 0; position: relative; }
        .nav-menu a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); transition: var(--transition); }
        .nav-menu a:hover::after, .nav-menu a.active::after { width: 100%; }
        .menu-toggle { display: none; cursor: pointer; font-size: 1.5rem; color: var(--light-color); position: relative; z-index: 1001;}
        .menu-toggle.active i::before { content: "\f00d"; /* fa-times */ }


        /* Hero Section */
        .hero { background: var(--dark-color); padding: 10rem 0 6rem; position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: -10%; right: -10%; width: 500px; height: 500px; background: radial-gradient(circle, rgba(var(--primary-color-val), 0.1) 0%, rgba(var(--primary-color-val), 0) 70%); z-index: 0; }
        .hero::after { content: ''; position: absolute; bottom: -10%; left: -10%; width: 500px; height: 500px; background: radial-gradient(circle, rgba(247,37,133, 0.08) 0%, rgba(247,37,133,0) 70%); z-index: 0; }
        .hero .container { position: relative; z-index: 1; text-align: center; }
        .hero-content { max-width: 800px; margin: 0 auto 3rem; }
        .hero h1 { font-family: var(--font-heading); font-size: 3.5rem; font-weight: 800; margin-bottom: 1.5rem; line-height: 1.2; color: var(--light-color); }
        .hero-text { font-size: 1.2rem; color: var(--text-light); margin-bottom: 2.5rem; max-width: 90%; margin-left: auto; margin-right: auto; }
        .rainbow-line { height: 4px; width: 100%; background: linear-gradient(90deg, var(--primary-color), var(--accent-color), var(--secondary-color)); margin-bottom: 3rem; }
        
        /* Downloader Box */
        .downloader-wrapper { background-color: var(--dark-medium); padding: 2.5rem; border-radius: var(--border-radius-lg); box-shadow: var(--box-shadow); margin-bottom: 2rem; position: relative; overflow: hidden; max-width: 800px; margin-left: auto; margin-right: auto; }
        .url-input-container { display: flex; margin-bottom: 1rem; position: relative; }
        .url-input { flex: 1; padding: 1.2rem 1.2rem 1.2rem 3.5rem; border: 2px solid rgba(255,255,255,0.1); border-radius: var(--border-radius) 0 0 var(--border-radius); font-size: 1.1rem; transition: var(--transition); background-color: rgba(255,255,255,0.05); color: var(--light-color); }
        .url-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(var(--primary-color-val), 0.2); }
        .url-input-container::before { content: '\f0c1'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 1.2rem; }
        .paste-btn { background-color: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.1); border-left:none; border-right:none; padding: 0 15px; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; color: var(--light-color); }
        .paste-btn:hover { background-color: var(--primary-light); color: var(--light-color); }
        .analyze-button { width: 160px; padding: 1.2rem; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: var(--light-color); border: none; border-radius: 0 var(--border-radius) var(--border-radius) 0; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: var(--transition); box-shadow: 0 4px 15px rgba(var(--primary-color-val), 0.2); }
        .analyze-button:hover { box-shadow: 0 6px 20px rgba(var(--primary-color-val), 0.4); transform: translateX(2px); }
        .analyze-button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: 0 4px 15px rgba(var(--primary-color-val),0.1); background: var(--gray-medium);}
        
        .video-preview { display: none; margin-top: 2rem; animation: fadeIn 0.5s ease; background-color: var(--dark-deep); padding: 1.5rem; border-radius: var(--border-radius); }
        .video-preview.active { display: block; }
        .video-info { display: flex; gap: 20px; margin-bottom: 20px; text-align: left; color: var(--text-color); }
        .video-thumbnail { flex-shrink: 0; position: relative; }
        .video-thumbnail img { width: 240px; height: auto; border-radius: var(--border-radius-sm); display: block; }
        .video-duration { position: absolute; bottom: 8px; right: 8px; background-color: rgba(0,0,0,0.75); color: white; padding: 3px 6px; border-radius: 4px; font-size: 0.8em; }
        .video-details { flex-grow: 1; }
        .video-title { font-size: 1.3em; margin-top: 0; margin-bottom: 8px; font-weight: 600; color: var(--light-color); }
        .video-meta { font-size: 0.85em; color: var(--text-light); margin-bottom: 10px;}
        .video-meta div { margin-bottom: 4px; display:flex; align-items:center; }
        .video-meta i { margin-right: 8px; color: var(--primary-light); width: 16px; text-align: center; }
        .video-description { font-size: 0.9em; color: var(--text-light); line-height: 1.5; margin-top: 10px; max-height: 75px; overflow-y: auto; padding-right: 5px; }
        .video-description::-webkit-scrollbar { width: 5px; }
        .video-description::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px;}
        .video-description::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 10px;}

        .format-selector { margin-top: 1.5rem; }
        .format-tabs { display: flex; justify-content: center; margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .format-tab { padding: 0.7rem 1.3rem; cursor: pointer; font-weight: 500; color: var(--text-light); border-bottom: 3px solid transparent; transition: var(--transition); font-size: 1rem; }
        .format-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .format-content { display: none; }
        .format-content.active { display: block; animation: fadeIn 0.3s ease; }
        .format-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .format-card { background-color: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: var(--border-radius-sm); padding: 1.2rem; cursor: pointer; transition: var(--transition); text-align: center; }
        .format-card:hover { border-color: var(--primary-color); transform: translateY(-4px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); background-color: rgba(var(--primary-color-val), 0.1); }
        .format-card.selected { border-color: var(--primary-color); background-color: rgba(var(--primary-color-val), 0.2); box-shadow: 0 0 0 2px var(--primary-color); transform: translateY(-2px); }
        .format-card i { font-size: 1.8rem; margin-bottom: 0.8rem; background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .format-name { font-weight: 500; margin-bottom: 0.4rem; font-size: 0.9rem; color: var(--light-color); line-height:1.3; }
        .format-info { color: var(--text-light); font-size: 0.75rem; }
        .format-info span { display: block; margin-bottom: 0.1rem; }
        .download-actions { text-align: center; margin-top: 1rem; }

        /* Illustration ( সংক্ষেপিত ) */
        .illustration-wrapper { display:none; /* Temporarily hide if not crucial for initial load */ }
        
        /* Sections (Features, How-to, FAQ, Footer - সংক্ষেপিত CSS) */
        .features, .how-to-use, .faq, .footer {padding: 4rem 0;} /* Simplified padding */
        /* ... (আপনার মূল সেকশনের CSS সংক্ষেপিত আকারে যুক্ত করতে পারেন, যদি সব দরকার না হয়) ... */
         .features-grid, .steps, .faq-container, .footer-content { margin-top:2rem;} /* Example simplified margins */
        /* FAQ specific styling */
        .faq-item { margin-bottom: 1rem; background-color: var(--dark-color); border-radius: var(--border-radius); overflow: hidden; transition: var(--transition); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .faq-item.active { box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .faq-question { padding: 1.2rem 1.5rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: 600; transition: var(--transition); color: var(--light-color); }
        .faq-item.active .faq-question { background-color: var(--primary-color); color: var(--light-color); }
        .faq-question h3 { font-size: 1rem; font-weight: 600; }
        .faq-question i { transition: var(--transition); font-size: 1rem; }
        .faq-item.active .faq-question i { transform: rotate(180deg); color: var(--light-color); }
        .faq-answer { height: 0; overflow: hidden; transition: height 0.3s ease-out; }
        .faq-answer-content { padding: 0 1.5rem 1.2rem; color: var(--text-light); line-height: 1.6; font-size:0.95rem; }
        .footer { background-color: var(--dark-medium); } .copyright p { font-size:0.85rem;}
         .footer-content { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;}
         .footer-links h3 {font-size:1.1rem;} .footer-links ul li a {font-size:0.9rem;}

        /* Loading Overlay */
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(12,15,37,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; display: none; backdrop-filter: blur(3px); }
        .loader { width: 70px; height: 70px; border-radius: 50%; position: relative; margin-bottom: 1.5rem; }
        .loader::before { content: ''; position: absolute; border-radius: 50%; width: 100%; height: 100%; background-image: linear-gradient(to right, var(--primary-color) 0%, var(--secondary-color) 100%); animation: spin 0.8s infinite linear; }
        .loader::after { content: ''; width: 80%; height: 80%; background-color: rgba(12,15,37,0.85); /* Should match parent overlay */ top: 50%; left: 50%; transform: translate(-50%,-50%); border-radius: 50%; }
        .loading-text { color: var(--light-color); font-size: 1.2rem; margin-bottom: 0.5rem; font-weight:500; }
        .loading-subtext { color: rgba(255,255,255,0.7); font-size: 0.9rem; }
        .progress-container { width: 280px; height: 6px; background-color: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 1rem; overflow: hidden; display:none; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); border-radius: 3px; transition: width 0.2s ease; }

        /* Toast Notifications */
        .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; max-width: 320px; }
        .toast { padding: 12px 18px; border-radius: var(--border-radius-sm); color: white; display: flex; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); animation: slideInRight 0.3s ease, fadeOutToast 0.3s ease 3.7s forwards; background-color: var(--primary-color); font-size:0.9rem; }
        .toast i { margin-right: 10px; font-size: 1.1rem; }
        .toast.success { background-color: #28a745; }
        .toast.error { background-color: #dc3545; }
        .toast.warning { background-color: #ffc107; color: #212529; }
        .toast.info { background-color: #17a2b8; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOutToast { 0% {opacity: 1; transform: translateX(0);} 99% {opacity: 0; transform: translateX(100%); height: auto; margin-bottom: 0; padding-top:12px; padding-bottom:12px;} 100% {opacity: 0; transform: translateX(100%); height:0; margin-bottom:-10px; padding-top:0; padding-bottom:0;}} /* Smooth removal */
        
        /* Media Queries */
        @media screen and (max-width: 768px) {
            .navbar .container { padding: 0.8rem 1rem; }
            .nav-menu { position: fixed; top: 0; left: -100%; background-color: var(--dark-deep); width: 100%; height:100vh; flex-direction: column; justify-content: center; box-shadow: 5px 0 15px rgba(0,0,0,0.2); transition: 0.4s cubic-bezier(0.23, 1, 0.32, 1); padding-top: 60px; /* Space for X button */ z-index: 999; }
            .nav-menu.active { left: 0; }
            .nav-menu li { margin: 0; text-align: center; width: 100%; }
            .nav-menu a { display: block; padding: 1.1rem 0; font-size:1.1rem; }
            .menu-toggle { display: flex; align-items:center; justify-content:center; width:40px; height:40px; }

            .url-input-container { flex-direction: column; }
            .url-input { border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0; padding: 1rem 1rem 1rem 3rem;}
            .url-input-container::before{ top: 1.6rem; /* Adjust for column layout padding */}
            .paste-btn {
                position: absolute; right: 1px; top: 1px;
                height: calc(3.2rem - 2px); /* Match input height (approx) */
                width: 45px; border-radius: 0 var(--border-radius-sm) 0 0;
                background-color: var(--dark-color); border: 2px solid rgba(255,255,255,0.1); border-left:none;
            }
            .analyze-button { width: 100%; border-radius: 0 0 var(--border-radius-sm) var(--border-radius-sm); padding: 1rem; }
            .format-grid { grid-template-columns: 1fr; } /* Single column for formats on small screens */
            .video-info { flex-direction: column; align-items: center; text-align:center; }
            .video-thumbnail img { width: 100%; max-width:280px; }
            .video-details {text-align:center;}
        }

    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="logo">
                    <a href="#home"><i class="fas fa-cloud-download-alt"></i> Tube<span>Saver</span></a>
                </div>
                <div class="menu-toggle" id="mobile-menu">
                    <i class="fas fa-bars"></i>
                </div>
                <ul class="nav-menu">
                    <li><a href="#home" class="nav-link active">Home</a></li>
                    <li><a href="#features" class="nav-link">Features</a></li>
                    <li><a href="#how-to-use" class="nav-link">How to Use</a></li>
                    <li><a href="#faq" class="nav-link">FAQ</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <section id="home" class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>YouTube Video Downloader</h1>
                <p class="hero-text">Paste your YouTube URL to start downloading videos or music</p>
            </div>
            
            <div class="rainbow-line"></div>
            
            <div class="downloader-wrapper">
                <div class="url-input-container">
                    <input type="text" id="video-url" class="url-input" placeholder="Paste YouTube URL here...">
                    <button id="paste-button" class="paste-btn" title="Paste from clipboard"><i class="fas fa-paste"></i></button>
                    <button id="analyze-button" class="analyze-button">Analyze</button>
                </div>
                
                <div id="video-preview" class="video-preview">
                    {/* Video preview content will be dynamically inserted here */}
                </div>
            </div>
            <!-- Illustration section (original HTML can be placed here if needed) -->
        </div>
    </section>

    <section id="features" class="features">
        <div class="container">
            <h2 class="section-title">Why Choose <span>TubeSaver</span></h2>
            <div class="features-grid">
                 <div class="feature-card"><div class="feature-icon"><i class="fas fa-bolt"></i></div><h3>Lightning Fast</h3><p>Download videos and music in seconds with our optimized tech.</p></div>
                 <div class="feature-card"><div class="feature-icon"><i class="fas fa-shield-alt"></i></div><h3>100% Secure</h3><p>No registration. We don't store your data. Privacy first.</p></div>
                 <div class="feature-card"><div class="feature-icon"><i class="fas fa-hand-holding-heart"></i></div><h3>Easy to Use</h3><p>Simple 3-step process: Paste, select format, download.</p></div>
                 <div class="feature-card"><div class="feature-icon"><i class="fas fa-photo-video"></i></div><h3>Multiple Formats</h3><p>Download MP4, WebM or extract audio. Various qualities.</p></div>
                 <div class="feature-card"><div class="feature-icon"><i class="fas fa-desktop"></i></div><h3>All Devices</h3><p>Works on desktop, tablet, mobile. No software needed.</p></div>
                 <div class="feature-card"><div class="feature-icon"><i class="fas fa-check-circle"></i></div><h3>High Quality</h3><p>Downloads up to 4K video and 320kbps audio.</p></div>
            </div>
        </div>
    </section>

    <section id="how-to-use" class="how-to-use">
        <div class="container">
            <h2 class="section-title">How to <span>Download</span></h2>
            <div class="steps" style="max-width:700px; margin: 0 auto;"> {/* Simplified steps container */}
                <div class="step"><div class="step-number">1</div><div class="step-content"><h3>Copy YouTube URL</h3><p>Find your video on YouTube. Copy the URL from browser or share button.</p></div></div>
                <div class="step"><div class="step-number">2</div><div class="step-content"><h3>Paste URL & Analyze</h3><p>Return here, paste the URL in the box, and click "Analyze".</p></div></div>
                <div class="step"><div class="step-number">3</div><div class="step-content"><h3>Select Format & Quality</h3><p>Choose your preferred video/audio format and desired quality.</p></div></div>
                <div class="step"><div class="step-number">4</div><div class="step-content"><h3>Start Download</h3><p>Click "Start Download". Your file will begin downloading automatically.</p></div></div>
            </div>
        </div>
    </section>

    <section id="faq" class="faq">
        <div class="container">
            <h2 class="section-title">Frequently Asked <span>Questions</span></h2>
            <div class="faq-container">
                 <div class="faq-item"><div class="faq-question"><h3>Is this service free?</h3><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><div class="faq-answer-content"><p>Yes, TubeSaver is 100% free. We run on minimal ads.</p></div></div></div>
                 <div class="faq-item"><div class="faq-question"><h3>Is it legal to download?</h3><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><div class="faq-answer-content"><p>Personal use is generally fine, but respect YouTube's ToS and copyright.</p></div></div></div>
                 <div class="faq-item"><div class="faq-question"><h3>Max quality?</h3><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><div class="faq-answer-content"><p>Up to 4K video and 320kbps audio, depending on original.</p></div></div></div>
                 <div class="faq-item"><div class="faq-question"><h3>Private/Restricted videos?</h3><i class="fas fa-chevron-down"></i></div><div class="faq-answer"><div class="faq-answer-content"><p>No, only publicly available videos can be processed.</p></div></div></div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-about" style="grid-column: span 2; @media (max-width:768px){grid-column:span 1;}"> {/* Simplified about */}
                    <div class="footer-logo"><a href="#home">Tube<span>Saver</span></a></div>
                    <p>Your free YouTube video and audio downloader.</p>
                     <div class="social-links" style="margin-top:1rem; justify-content: center @media(min-width:769px){justify-content: flex-start;}">
                        <a href="#" class="social-link" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a> 
                        <a href="#" class="social-link" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
                <div class="footer-links"><h3>Quick Links</h3><ul><li><a href="#home">Home</a></li><li><a href="#features">Features</a></li></ul></div>
                <div class="footer-links"><h3>Legal</h3><ul><li><a href="#">Privacy</a></li><li><a href="#">Terms</a></li></ul></div>
            </div>
            <div class="copyright">
                <p>© <span id="copyright-year">2024</span> TubeSaver. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="loading-overlay" class="loading-overlay">
        <div class="loader"></div>
        <p class="loading-text">Processing your request...</p>
        <p class="loading-subtext">This may take a few moments</p>
        <div class="progress-container" id="progress-container-main">
            <div class="progress-bar" id="progress-bar-main"></div>
        </div>
    </div>
    
    <div class="toast-container" id="toast-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Element References ---
            const mobileMenu = document.getElementById('mobile-menu');
            const navMenu = document.querySelector('.nav-menu');
            const navLinks = document.querySelectorAll('.nav-link');
            const videoUrlInput = document.getElementById('video-url');
            const pasteButton = document.getElementById('paste-button');
            const analyzeButton = document.getElementById('analyze-button');
            const videoPreview = document.getElementById('video-preview');
            const loadingOverlay = document.getElementById('loading-overlay');
            const mainProgressBar = document.getElementById('progress-bar-main');
            const mainProgressContainer = document.getElementById('progress-container-main');
            const loadingOverlayText = loadingOverlay.querySelector('.loading-text');
            const faqItems = document.querySelectorAll('.faq-item');
            const toastContainer = document.getElementById('toast-container');

            // --- Initializations ---
            const copyrightYearEl = document.getElementById('copyright-year');
            if(copyrightYearEl) copyrightYearEl.textContent = new Date().getFullYear();
            if(analyzeButton && videoUrlInput) validateUrl(videoUrlInput.value); // Initial validation

            // --- Event Listeners ---

            // Mobile Menu Toggle
            if (mobileMenu && navMenu) {
                mobileMenu.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    this.classList.toggle('active'); 
                });
            }

            // Navigation Link Smooth Scroll & Active State
            navLinks.forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (navMenu && navMenu.classList.contains('active')) {
                        navMenu.classList.remove('active');
                        if(mobileMenu) mobileMenu.classList.remove('active');
                    }
                    const targetId = this.getAttribute('href');
                    const targetElement = targetId === '#' ? document.body : document.querySelector(targetId);
                    
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 70,
                            behavior: 'smooth'
                        });
                    }
                    navLinks.forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Scroll-based Active Link Highlighting
            window.addEventListener('scroll', () => {
                let currentSectionId = '';
                document.querySelectorAll('section[id]').forEach(section => {
                    if (pageYOffset >= section.offsetTop - 80) {
                        currentSectionId = section.getAttribute('id');
                    }
                });
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${currentSectionId}`) {
                        link.classList.add('active');
                    }
                });
                 if (!currentSectionId && window.pageYOffset < (window.innerHeight / 2)) {
                    const homeLink = document.querySelector('.nav-link[href="#home"]');
                    if (homeLink) { navLinks.forEach(l => l.classList.remove('active')); homeLink.classList.add('active');}
                }
            });


            // Paste Button
            if (pasteButton && videoUrlInput) {
                pasteButton.addEventListener('click', function() {
                    navigator.clipboard.readText()
                        .then(text => { videoUrlInput.value = text; validateUrl(text); })
                        .catch(err => { console.error('Clipboard paste error:', err); showToast('Could not paste. Paste manually.', 'warning'); });
                });
            }

            // URL Input Validation
            if (videoUrlInput) {
                videoUrlInput.addEventListener('input', function() { validateUrl(this.value); });
            }

            // Analyze Button Click
            if (analyzeButton) {
                analyzeButton.addEventListener('click', handleAnalyzeClick);
            }

            // FAQ Accordion
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                if (question) {
                    question.addEventListener('click', () => {
                        const answer = item.querySelector('.faq-answer');
                        const answerContent = item.querySelector('.faq-answer-content');
                        if (item.classList.contains('active')) {
                            item.classList.remove('active');
                            answer.style.height = '0px';
                        } else {
                            // Close other active items
                            faqItems.forEach(otherItem => {
                                if (otherItem.classList.contains('active')) {
                                    otherItem.classList.remove('active');
                                    otherItem.querySelector('.faq-answer').style.height = '0px';
                                }
                            });
                            item.classList.add('active');
                            answer.style.height = answerContent.offsetHeight + 'px';
                        }
                    });
                }
            });

            // --- Core Functions ---

            function validateUrl(url) {
                const trimmedUrl = url.trim();
                const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                if (analyzeButton) {
                    analyzeButton.disabled = !youtubeRegex.test(trimmedUrl);
                }
            }

            async function handleAnalyzeClick() {
                const url = videoUrlInput.value.trim();
                if (!url) { return showToast('Please enter a YouTube URL', 'error'); }
                if (!/youtube\.com|youtu\.be/.test(url)) { return showToast('Please enter a valid YouTube URL', 'warning'); }

                showLoading('Analyzing URL...', false); // No progress bar for analysis

                try {
                    const response = await fetch('http://localhost:5000/api/analyze-url', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url }),
                    });
                    const data = await response.json();

                    if (!response.ok || data.error) {
                        throw new Error(data.error || `Server error: ${response.status}`);
                    }
                    if (!data.formats || (data.formats.video.length === 0 && data.formats.audio.length === 0)) {
                       throw new Error('No downloadable formats found for this video.');
                    }

                    hideLoading(true, () => {
                        createVideoPreview(data);
                        showToast('Analysis complete! Select a format.', 'success');
                        if(videoPreview) videoPreview.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                } catch (error) {
                    console.error('Analysis error:', error);
                    hideLoading(false);
                    showToast(error.message || 'Analysis failed. Please try again.', 'error');
                    if(videoPreview) { videoPreview.classList.remove('active'); videoPreview.innerHTML = '';}
                }
            }

            function createVideoPreview(videoData) {
                if (!videoData || !videoPreview) return;
                
                const { thumbnailUrl = 'https://via.placeholder.com/240x135.png?text=No+Preview', title = 'N/A Title', duration = '', author = '', views = '', description = '', formats, originalUrl } = videoData;

                let videoFormatsHtml = formats.video && formats.video.length > 0 ?
                    formats.video.map(f => `
                        <div class="format-card" data-itag="${f.itag}" title="Download ${f.displayName || ''}">
                            <i class="fas fa-film"></i>
                            <div class="format-name">${f.displayName || `Video ${f.qualityLabel || f.itag}`}</div>
                            <div class="format-info">
                                <span>${f.qualityLabel || 'Video'}</span>
                                <span>${f.container || ''} | ~${f.fileSize || 'N/A'}</span>
                            </div>
                        </div>`).join('') : 
                    "<p style='color: var(--text-light); text-align:center; grid-column: 1 / -1;'>No video formats available.</p>";

                let audioFormatsHtml = formats.audio && formats.audio.length > 0 ?
                    formats.audio.map(f => `
                        <div class="format-card" data-itag="${f.itag}" title="Download ${f.displayName || ''}">
                            <i class="fas fa-music"></i>
                            <div class="format-name">${f.displayName || `Audio ${f.audioBitrate || ''}kbps`}</div>
                            <div class="format-info">
                                <span>${f.audioBitrate ? f.audioBitrate + 'kbps' : 'Audio'}</span>
                                <span>${f.container || ''} | ~${f.fileSize || 'N/A'}</span>
                            </div>
                        </div>`).join('') :
                    "<p style='color: var(--text-light); text-align:center; grid-column: 1 / -1;'>No audio formats available.</p>";

                videoPreview.innerHTML = `
                    <div class="video-info">
                        <div class="video-thumbnail">
                            <img src="${thumbnailUrl}" alt="Video thumbnail" onerror="this.onerror=null;this.src='https://via.placeholder.com/240x135.png?text=No+Preview';">
                            ${duration ? `<div class="video-duration">${duration}</div>` : ''}
                        </div>
                        <div class="video-details">
                            <h3 class="video-title" title="${title}">${title.length > 70 ? title.substring(0,67)+'...' : title}</h3>
                            ${author ? `<div class="video-meta"><i class="fas fa-user-circle"></i> ${author}</div>` : ''}
                            ${views ? `<div class="video-meta"><i class="fas fa-eye"></i> ${views} views</div>` : ''}
                            ${description ? `<p class="video-description">${description.substring(0, 150)}${description.length > 150 ? '...' : ''}</p>` : ''}
                        </div>
                    </div>
                    <div id="format-selector-dynamic" class="format-selector">
                        <h3 style="text-align: center; margin-bottom: 1.5rem; font-size:1.2rem; color:var(--primary-light);">Select Download Format</h3>
                        <div class="format-tabs">
                            <div class="format-tab active" data-tab="video-formats">Video</div>
                            <div class="format-tab" data-tab="audio-formats">Audio</div>
                        </div>
                        <div class="format-content active" data-content="video-formats"><div class="format-grid">${videoFormatsHtml}</div></div>
                        <div class="format-content" data-content="audio-formats"><div class="format-grid">${audioFormatsHtml}</div></div>
                        <div class="download-actions"><button id="start-download-btn" class="btn btn-lg">Start Download</button></div>
                    </div>`;
                videoPreview.classList.add('active');

                // Add event listeners for dynamic content
                videoPreview.querySelectorAll('.format-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        videoPreview.querySelectorAll('.format-tab, .format-content').forEach(el => el.classList.remove('active'));
                        this.classList.add('active');
                        const contentToShow = videoPreview.querySelector(`.format-content[data-content="${this.dataset.tab}"]`);
                        if(contentToShow) contentToShow.classList.add('active');
                    });
                });
                videoPreview.querySelectorAll('.format-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const parentGrid = this.closest('.format-grid');
                        parentGrid.querySelectorAll('.format-card').forEach(c => c.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
                const downloadBtn = videoPreview.querySelector('#start-download-btn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', () => handleDownload(originalUrl, videoData.title));
                }
            }

            async function handleDownload(originalVideoUrl, videoTitle = "download") {
                const selectedFormatCard = videoPreview.querySelector('.format-card.selected');
                if (!selectedFormatCard) { return showToast('Please select a format to download', 'warning'); }
                
                const itag = selectedFormatCard.dataset.itag;
                if (!originalVideoUrl || !itag) { return showToast('Missing video URL or format ID.', 'error'); }

                showLoading('Preparing download...', true); // Show progress bar for download

                try {
                    const downloadUrl = `http://localhost:5000/api/download?url=${encodeURIComponent(originalVideoUrl)}&itag=${itag}`;
                    
                    // Using simple window.open for direct download by browser
                    // This method won't allow for easy progress display from fetch API
                    const newWindow = window.open(downloadUrl, '_blank');
                    if(!newWindow || newWindow.closed || typeof newWindow.closed=='undefined') {
                         showToast('Popup blocked! Please allow popups for this site.', 'warning');
                         hideLoading(false);
                         return;
                    }

                    // Since direct download doesn't give fetch progress, simulate or just indicate started.
                    // Or for more control (and complexity), use fetch and Blob method below.
                    // For now, just hide loader after a bit assuming browser takes over.
                    let progress = 0;
                    const progInterval = setInterval(() => {
                        progress +=10;
                        if(mainProgressBar) mainProgressBar.style.width = `${Math.min(progress, 100)}%`;
                        if(progress >=110) { // A bit more to ensure it shows 100%
                             clearInterval(progInterval);
                             hideLoading(true, () => {
                                showToast(`Download for "${videoTitle}" started!`, 'success');
                                videoUrlInput.value = '';
                                videoPreview.classList.remove('active'); videoPreview.innerHTML = '';
                                validateUrl('');
                            });
                        }
                    }, 200);


                } catch (error) {
                    console.error('Download initiation error:', error);
                    hideLoading(false);
                    showToast(error.message || 'Could not start download.', 'error');
                }
            }
            
            // --- Utility Functions ---
            function showLoading(text = 'Processing...', showProgressBar = false) {
                if(loadingOverlayText) loadingOverlayText.textContent = text;
                if(mainProgressContainer) mainProgressContainer.style.display = showProgressBar ? 'block' : 'none';
                if(mainProgressBar) mainProgressBar.style.width = '0%';
                if(loadingOverlay) loadingOverlay.style.display = 'flex';
            }

            function hideLoading(success = true, callback, delay = 300) { // success not used here but can be
                 if (loadingOverlay) {
                    // Ensure progress bar is full if it was shown
                    if (mainProgressContainer && mainProgressContainer.style.display === 'block' && mainProgressBar) {
                        mainProgressBar.style.width = '100%';
                        setTimeout(() => { // Let 100% show for a moment
                            loadingOverlay.style.display = 'none';
                            if (callback) callback();
                        }, 500); // Extended delay if progress bar was shown
                    } else {
                         setTimeout(() => {
                            loadingOverlay.style.display = 'none';
                            if (callback) callback();
                        }, delay);
                    }
                } else if (callback) {
                    callback();
                }
            }

            function showToast(message, type = 'info') {
                if (!toastContainer) return;
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                let iconClass = 'fa-info-circle';
                if (type === 'success') iconClass = 'fa-check-circle';
                else if (type === 'error') iconClass = 'fa-exclamation-circle';
                else if (type === 'warning') iconClass = 'fa-exclamation-triangle';
                toast.innerHTML = `<i class="fas ${iconClass}"></i> ${message}`;
                toastContainer.appendChild(toast);
                setTimeout(() => { // Animation handles removal, this is just a fallback if animation fails.
                    if (toast.parentNode) toast.remove();
                }, 4000); // A bit longer than animation
            }

        }); // End DOMContentLoaded
    </script>
</body>
</html>
